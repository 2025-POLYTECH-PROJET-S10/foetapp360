{"version":3,"file":"attempt.min.js","sources":["../src/attempt.js"],"sourcesContent":["define(['jquery'], function($) {\n    return {\n        init: function() {\n            $(\".rotation_hippotrack_container\").each(function() {\n                let rotationhippotrack_container = $(this);\n                let hippotrack_container = rotationhippotrack_container.find(\".hippotrack_container\");\n\n                if (!hippotrack_container.length) { return; }\n\n                let schemaType = hippotrack_container.data(\"schema-type\");\n                if (!schemaType) { return; }\n\n                let targetInteriorImage = hippotrack_container.find(\".\" + schemaType + \"_interieur\");\n                let targetContourImage = hippotrack_container.find(\".\" + schemaType + \"_contour\");\n\n                let rotateSlider = rotationhippotrack_container.find(\".rotate-slider\");\n                let moveSlider = rotationhippotrack_container.find(\".move-axis-slider\");\n\n                let rotationAngle = rotateSlider.val();\n                let translateDistance = moveSlider.val();\n                updateTransform();\n\n                /**\n                 * Met à jour la transformation CSS des images.\n                 */\n                function updateTransform() {\n                    let radian = (rotationAngle * Math.PI) / 180;\n                    let xOffset = translateDistance * Math.sin(radian);\n                    let yOffset = -translateDistance * Math.cos(radian);\n\n                    if (targetInteriorImage.length) {\n                        targetInteriorImage.css(\"transform\", `translate(${xOffset}px, ${yOffset}px) rotate(${rotationAngle}deg)`);\n                    }\n                    if (targetContourImage.length) {\n                        targetContourImage.css(\"transform\", `rotate(${rotationAngle}deg)`);\n                    }\n                }\n\n                rotateSlider.on(\"input\", function() {\n                    rotationAngle = parseInt($(this).val(), 10);\n                    updateTransform();\n                });\n\n                moveSlider.on(\"input\", function() {\n                    translateDistance = parseInt($(this).val(), 10);\n                    updateTransform();\n                });\n            });\n\n            let imageDatabase = JSON.parse(document.getElementById(\"image_database\").dataset.values);\n            $(\".image_cycling_hippotrack_container\").each(function() {\n                let hippotrack_container = $(this);\n                let cyclingImage = hippotrack_container.find(\".hippotrack_attempt_cycling-image\");\n                let hiddenInput = hippotrack_container.find(\".hippotrack_attempt_selected_position\");\n                /**\n                 * Met à jour l'image affichée en fonction de la position et de la variation.\n                 */\n                function increaseImage() {\n                    let field = hippotrack_container.find(\".hippotrack_field\");\n                    let images = Object.values(imageDatabase[field[0].dataset.values]); // Convertir en tableau indexé\n                    let imageActuelle = cyclingImage.attr(\"src\");\n                    let currentIndex = images.indexOf(imageActuelle);\n                    if (currentIndex === -1) {\n                        currentIndex = 0; // Sécurité : si l’image actuelle n’existe pas dans la liste, commencer à 0\n                    }\n                    currentIndex = currentIndex + 1;\n                    if(currentIndex == images.length){\n                        currentIndex = 0;\n                    }\n                    cyclingImage.attr(\"src\", images[currentIndex]);\n                    hiddenInput.val(images[currentIndex]);\n                }\n                /**\n                 * Met à jour l'image affichée en fonction de la position et de la variation.\n                 */\n                function decreaseImage() {\n                    let field = hippotrack_container.find(\".hippotrack_field\");\n                    let images = Object.values(imageDatabase[field[0].dataset.values]); // Convertir en tableau indexé\n                    let imageActuelle = cyclingImage.attr(\"src\");\n                    let currentIndex = images.indexOf(imageActuelle);\n                    if (currentIndex === -1) {\n                        currentIndex = 0; // Sécurité : si l’image actuelle n’existe pas dans la liste, commencer à 0\n                    }\n                    currentIndex = currentIndex - 1;\n                    if(currentIndex < 0){\n                        currentIndex = images.length-1;\n                    }\n                    cyclingImage.attr(\"src\", images[currentIndex]);\n                    hiddenInput.val(images[currentIndex]);\n                }\n\n                hippotrack_container.find(\".hippotrack_attempt_prev-btn\").on(\"click\", function() {\n                    decreaseImage();\n                });\n\n                hippotrack_container.find(\".hippotrack_attempt_next-btn\").on(\"click\", function() {\n                    increaseImage();\n                });\n            });\n\n            // Gestion des onglets et du contenu affiché\n            $(\".attempt_container\").hide();\n            $(\".hippotrack-tab.active\").each(function() {\n                $($(this).data(\"target\")).show();\n                $(this).addClass(\"hippotrack_given_tab_input\");\n            });\n\n            $(\".hippotrack-tab\").click(function() {\n                $(\".hippotrack-tab\").removeClass(\"active\");\n                $(this).addClass(\"active\");\n\n                $(\".attempt_container\").hide();\n                $($(this).data(\"target\")).show();\n            });\n\n            // Gestion message lorsque inputs manquants.\n            document.getElementById(\"submit_attempt\").addEventListener(\"click\", function(event) {\n                let inputs = document.querySelectorAll(\"#attempt_form input[type='text']\");\n                // Vérifier si l'overlay existe déjà\n                let overlay = document.getElementById('attempt_error_overlay');\n                if (!overlay) {\n                    // Créer l'élément overlay si il n'existe pas\n                    overlay = document.createElement('div');\n                    overlay.id = 'attempt_error_overlay';\n                    overlay.innerHTML = `\n                        <p>Veuillez remplir tous les champs.</p>\n                        <button id=\"attempt_close_overlay\">Fermer</button>\n                    `;\n                    document.body.appendChild(overlay);\n                    // Ajouter un gestionnaire d'événements pour fermer l'overlay\n                    document.getElementById(\"attempt_close_overlay\").addEventListener(\"click\", function() {\n                        overlay.style.display = 'none'; // Cache l'overlay\n                    });\n                }\n                // Vérifier si un champ est vide\n                for (let input of inputs) {\n                    if (input.value.trim() === \"\") {\n                        overlay.style.display = 'flex';  // Affiche l'overlay\n                        event.preventDefault(); // Empêche l'envoi du formulaire\n                        return;\n                    }\n                }\n                // Si tout est validé, on cache l'overlay\n                overlay.style.display = 'none';\n            });\n        }\n    };\n});\n"],"names":["define","$","init","each","rotationhippotrack_container","this","hippotrack_container","find","length","schemaType","data","targetInteriorImage","targetContourImage","rotateSlider","moveSlider","rotationAngle","val","translateDistance","updateTransform","radian","Math","PI","xOffset","sin","yOffset","cos","css","on","parseInt","imageDatabase","JSON","parse","document","getElementById","dataset","values","cyclingImage","hiddenInput","field","images","Object","imageActuelle","attr","currentIndex","indexOf","decreaseImage","increaseImage","hide","show","addClass","click","removeClass","addEventListener","event","inputs","querySelectorAll","overlay","createElement","id","innerHTML","body","appendChild","style","display","input","value","trim","preventDefault"],"mappings":"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"}